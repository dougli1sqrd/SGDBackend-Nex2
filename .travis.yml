language: python
python:
  - "2.7"
install:
  - pip install -r requirements.txt
  - pip install pyramid-celery==3.0.0
addons:
  postgresql: "9.6"
before_script:
  - psql -c "CREATE USER nex WITH PASSWORD '[passwd]'"
  - psql -U postgres postgres -c "CREATE DATABASE sgd WITH OWNER nex ENCODING 'UTF8'"
  - psql -U postgres sgd -c "CREATE ROLE CURATOR"
  - psql -U postgres sgd -c "CREATE USER OTTO WITH PASSWORD '[passwd]'"
  - psql -U postgres sgd -c "GRANT CURATOR to OTTO"
  - psql -U postgres sgd -c "CREATE SCHEMA nex AUTHORIZATION nex"
  - psql -U postgres sgd -c "GRANT USAGE ON SCHEMA nex TO CURATOR"
script:
  echo 'export NEX2_URI="postgresql://nex:passwd@localhost/sgd"' > test_variables.sh
  source test_variables.sh && nosetests -s
